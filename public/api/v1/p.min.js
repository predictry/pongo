var Predictry=(function(){var a="http://dashboard.predictry.com/api/v1/";var t=null;var B=window;var k={action:null,user_id:null,session_id:null,item_id:null,description:""};var H={placementId:null,platformVer:null,recoType:null};var b=data=reco_data={};var I=optional_params=null;var l=-1;function F(){B=window;reco_data=data={};this.cart_id=J();H.placementId=B.PE_placementId;H.platformVer=B.PE_platformVer;H.recoType=B.PE_recoType;k.session_id=this.getSessionID();I=new Array("user_id","action","item_id","session_id","description");optional_params=new Array("item_properties","action_properties");b={status:"success",message:""};var P=E(document.location.search);if(P!==undefined&&typeof P==="object"&&P.predictry_src!==undefined){t=P.predictry_src}}function u(R){R=M(R,k);if(t!==null){if(R.action_properties!==undefined){R.action_properties.rec=true}else{if(R.action_properties===undefined){R.action_properties={rec:true}}}}if(R.action==="complete_purchase"){if(R.action_properties!==undefined){R.action_properties.cart_id=this.cart_id}else{if(R.action_properties===undefined){R.action_properties={cart_id:this.cart_id}}}this.cart_id=J()}for(var P in R){if(!G(P,optional_params)){if(((R[P]===""||(R[P]===null))&&G(P,I))){b.status="failed";b.message=P+" cannot be empty";return false}}if(P==="item_properties"){for(var Q in R[P]){R["item_properties["+Q+"]"]=R[P][Q]}delete R.item_properties}if(P==="action_properties"){for(var Q in R[P]){R["action_properties["+Q+"]"]=R[P][Q]}delete R.action_properties}}R.action_type="single";return R}function v(R){reco_data=M(R,k);for(var P in R){if(!G(P,optional_params)){if(((R[P]===""||(R[P]===null))&&G(P,I))){b.status="failed";b.message=P+" cannot be empty";return false}}if(P==="action_properties"){for(var Q in R[P]){R["action_properties["+Q+"]"]=R[P][Q]}delete R.action_properties}}return true}function j(R){var Q=false;if(R!==undefined){Q=u(m(R))}else{P.message="action data undefined";P.status="failed"}if(Q!==false){var P=d(Q);if(P.status==="success"&&Q.action==="add_to_cart"){if(t!==null){if(R.action_properties!==undefined){R.action_properties.rec=true}else{if(R.action_properties===undefined){R.action_properties={rec:true}}}}if(R.action_properties!==undefined){var S=(R.action_properties.qty!==undefined)?R.action_properties.qty:1;r(R.item_id,S,"added");if(R.action_properties.rec!==undefined&&R.action_properties.rec){A(R.item_id)}}else{r(R.item_id,1,"added")}}if(P.status==="success"&&Q.action==="complete_purchase"){g()}return P}else{return JSON.stringify(P)}}function c(P){j(P)}function d(P){return C("POST",a+"predictry?",P)}function s(R,Q){if(Q===undefined){return}var P=new XMLHttpRequest();P.overrideMimeType("application/json");P.open(R,Q,false);P.setRequestHeader("X-Predictry-Server-Tenant-ID",B.PE_tenantId);P.setRequestHeader("X-Predictry-Server-Api-Key",B.PE_apiKey);P.onreadystatechange=function(){if(P.readyState===4&&P.status===200){jsonResponse=JSON.parse(P.responseText);return jsonResponse}};P.send(null)}function C(S,Q,R){var P="";if(typeof jQuery!=="undefined"){jQuery.ajax({type:S,url:Q,async:false,data:R,dataType:"json",beforeSend:function(T){T.setRequestHeader("X-Predictry-Server-Tenant-ID",B.PE_tenantId);T.setRequestHeader("X-Predictry-Server-Api-Key",B.PE_apiKey)},success:function(T){P=T},error:function(T){P=T}})}else{console.log("error >> jQuery required ");return}return P}function z(T){var S=new Array("item_id","description");var P=new Array("item_properties","action_properties");for(var R=0;R<T.actions.length;R++){for(var V in T.actions[R]){if(!G(V,P)){if(((T.actions[R][V]===""||(T.actions[R][V]===null))&&G(V,S))){b.status="failed";b.message=V+" cannot be empty";return false}}if(T.action==="complete_purchase"&&V==="item_id"){var X=T.actions[R][V];var W=L();var U=W.c;var Q=T.actions[R];if(Q.action_properties!==undefined){Q.action_properties.cart_id=this.cart_id}else{if(Q.action_properties===undefined){Q.action_properties={cart_id:this.cart_id}}}if(G(X,U)){if(Q.action_properties!==undefined){Q.action_properties.rec=true}else{if(Q.action_properties===undefined){Q.action_properties={rec:true}}}}}}}this.cart_id=J();T.session_id=e();T.action_type="bulk";return T}function f(Q){var P=false;if(Q!==undefined){if(Q.action===undefined){b.message="action name undefined";b.status="failed"}if(Q.user_id===undefined){b.message="user id undefined";b.status="failed"}}else{b.message="action data undefined";b.status="failed"}P=z(Q);if(P!==false){return C("POST",a+"predictry?",P)}else{console.log(JSON.stringify(b))}}function w(P){reco_data=M(P,k);reco_data=M(reco_data,H);if(reco_data.algo===undefined){reco_data.algo="otherusersalsoviewed"}var R;var Q=p(reco_data);reco_url=a+"recommendation?"+Q;if(typeof(noDrawingNeeded)==="undefined"){if(window.PE_recoType==="pe_grid"){R=y}else{R=O}}else{R=null}return C("GET",a+"recommendation?",reco_data)}function O(Q){if(Q!==null){try{var P=Q.recomm}catch(R){return}if("undefined"==typeof(P.length)){P=new Array(P)}if(P.length>0){listString="<ul>";for(x=0;x<P.length;x++){listString+='<li><a href="'+P[x].item_properties.item_url+'">'+P[x].description+"</a></li>"}elem_predictry.innerHTML+=listString+"</ul>"}}}function y(P){return"work in progress"}function K(P,R,Q){var S={item_id:P,description:R,properties:Q};return C("POST",a+"item?",S)}function h(S,P,R){var Q={placement_id:S,properties:P,rec_items:R,session:e()};return C("POST",a+"placement?",Q)}function J(){var P=C("POST",a+"cart?",{session:e()});var Q=false;if(P.status==="success"){Q=P.response.cart_id}return Q}function r(P,S,Q){var R={cart_id:l,item_id:P,qty:S,event:Q};return C("POST",a+"cartlog?",R)}function A(P){var Q=L();cartItemIDs=Q.c;if(P!==undefined&&!G(P,cartItemIDs)){cartItemIDs.push(P)}return g(cartItemIDs)}function n(P){var Q=L();cartItemIDs=Q.c;if(P!==undefined&&G(P,cartItemIDs)){cartItemIDs.pop(P)}return g(cartItemIDs)}function L(){var Q="predictry";var P=document.cookie.match(new RegExp(Q+"=([^;]+)"));if(P&&JSON.parse(P[1])){return JSON.parse(P[1])}else{return g()}}function g(Q){var P="predictry";var R={c:[],s:e()};if(Q!==undefined){R={c:Q,s:e()}}String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=P+"="+JSON.stringify(R)+"; path=/";return R}function M(Q,S){var R=Q;for(var P in S){src=R[P];copy=S[P];if(src!=null){continue}else{if(copy!==undefined){R[P]=copy}}}return R}function p(S,R){var P="";for(var Q in S){var T=S[Q];if(R!==undefined){P+=encodeURIComponent(Q)+"[]="+encodeURIComponent(T)+"&"}else{P+=encodeURIComponent(Q)+"="+encodeURIComponent(T)+"&"}}if(P.length>0){P=P.substring(0,P.length-1)}return P}function G(S,R){var Q=R.length;for(var P=0;P<Q;P++){if(R[P]===S){return true}}return false}function N(Q){var P=0;switch(Q.toLowerCase()){case"view":P=1;break;case"rate":P=2;break;case"add_to_cart":P=3;break;case"buy":P=4;break;default:P=1;break}return P}function D(){var P="predictry_session";var Q=o(15);String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=P+"="+Q+"; path=/";g();return Q}function o(P){chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";returnValue="";for(x=0;x<P;x++){i=Math.floor(Math.random()*62);returnValue+=chars.charAt(i)}return returnValue}function e(){var R="predictry_session=";var P=document.cookie.split(";");for(var Q=0;Q<P.length;Q++){var S=P[Q];while(S.charAt(0)==" "){S=S.substring(1,S.length)}if(S.indexOf(R)==0){return S.substring(R.length,S.length)}}return D()}function q(P){document.cookie=[P,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.",window.location.host.toString()].join("");return}function m(Q){if(null==Q||"object"!=typeof Q){return Q}var R=Q.constructor();for(var P in Q){if(Q.hasOwnProperty(P)){R[P]=Q[P]}}return R}function E(P){P=P.split("+").join(" ");var S={},R,Q=/[?&]?([^=]+)=([^&]*)/g;while(R=Q.exec(P)){S[decodeURIComponent(R[1])]=decodeURIComponent(R[2])}return S}return{init:F,getSessionID:e,sendAction:j,sendBulkActions:f,getRecommendedItems:w,updateItem:K,getCartID:J,getCartSession:L,setCartSession:A,removeItemCartSession:n,setCartLog:r,buildUrl:p,drawGrid:y,drawList:O,clone:m,placement_instance_id:t,cart_id:l}}(Predictry||function(){return undefined}));if(typeof Predictry!==undefined&&typeof Predictry==="object"){Predictry.init()};