var Predictry=(function(){var a="http://dashboard.predictry.com/api/v1/";var K=null;var z=window;var j={action:null,user_id:null,session_id:null,item_id:null,description:""};var G={widgetId:null,platformVer:null,recoType:null};var b=data=reco_data={};var H=optional_params=null;var k=-1;function E(){z=window;reco_data=data={};this.cart_id=I();G.widgetId=z.PE_widgetId;j.session_id=this.getSessionID();H=new Array("user_id","action","item_id","session_id","description");optional_params=new Array("item_properties","action_properties");b={status:"success",message:""};var P=D(document.location.search);if(P!==undefined&&typeof P==="object"&&P.predictry_src!==undefined){K=P.predictry_src}}function s(R){R=M(R,j);if(K!==null){if(R.action_properties!==undefined){R.action_properties.rec=true}else{if(R.action_properties===undefined){R.action_properties={rec:true}}}}if(R.action==="complete_purchase"){if(R.action_properties!==undefined){R.action_properties.cart_id=this.cart_id}else{if(R.action_properties===undefined){R.action_properties={cart_id:this.cart_id}}}this.cart_id=I()}for(var P in R){if(!F(P,optional_params)){if(((R[P]===""||(R[P]===null))&&F(P,H))){b.status="failed";b.message=P+" cannot be empty";return false}}if(P==="item_properties"){for(var Q in R[P]){R["item_properties["+Q+"]"]=R[P][Q]}delete R.item_properties}if(P==="action_properties"){for(var Q in R[P]){R["action_properties["+Q+"]"]=R[P][Q]}delete R.action_properties}}R.action_type="single";return R}function t(R){reco_data=M(R,j);for(var P in R){if(!F(P,optional_params)){if(((R[P]===""||(R[P]===null))&&F(P,H))){b.status="failed";b.message=P+" cannot be empty";return false}}if(P==="action_properties"){for(var Q in R[P]){R["action_properties["+Q+"]"]=R[P][Q]}delete R.action_properties}}return true}function h(R){var Q=false;if(R!==undefined){Q=s(l(R))}else{P.message="action data undefined";P.status="failed"}if(Q!==false){var P=d(Q);if(P.status==="success"&&Q.action==="add_to_cart"){if(K!==null){if(R.action_properties!==undefined){R.action_properties.rec=true}else{if(R.action_properties===undefined){R.action_properties={rec:true}}}}if(R.action_properties!==undefined){var S=(R.action_properties.qty!==undefined)?R.action_properties.qty:1;q(R.item_id,S,"added");if(R.action_properties.rec!==undefined&&R.action_properties.rec){y(R.item_id)}}else{q(R.item_id,1,"added")}}if(P.status==="success"&&Q.action==="complete_purchase"){g()}return P}else{return JSON.stringify(P)}}function c(P){h(P)}function d(P){return B("POST",a+"predictry?",P)}function r(R,Q){if(Q===undefined){return}var P=new XMLHttpRequest();P.overrideMimeType("application/json");P.open(R,Q,false);P.setRequestHeader("X-Predictry-Server-Tenant-ID",z.PE_tenantId);P.setRequestHeader("X-Predictry-Server-Api-Key",z.PE_apiKey);P.onreadystatechange=function(){if(P.readyState===4&&P.status===200){jsonResponse=JSON.parse(P.responseText);return jsonResponse}};P.send(null)}function B(S,Q,R){var P="";if(typeof jQuery!=="undefined"){jQuery.ajax({type:S,url:Q,async:false,data:R,dataType:"json",beforeSend:function(T){T.setRequestHeader("X-Predictry-Server-Tenant-ID",z.PE_tenantId);T.setRequestHeader("X-Predictry-Server-Api-Key",z.PE_apiKey)},success:function(T){P=T},error:function(T){P=T}})}else{console.log("error >> jQuery required ");return}return P}function w(T){var S=new Array("item_id","description");var P=new Array("item_properties","action_properties");for(var R=0;R<T.actions.length;R++){for(var V in T.actions[R]){if(!F(V,P)){if(((T.actions[R][V]===""||(T.actions[R][V]===null))&&F(V,S))){b.status="failed";b.message=V+" cannot be empty";return false}}if(T.action==="complete_purchase"&&V==="item_id"){var X=T.actions[R][V];var W=L();var U=W.c;var Q=T.actions[R];if(Q.action_properties!==undefined){Q.action_properties.cart_id=this.cart_id}else{if(Q.action_properties===undefined){Q.action_properties={cart_id:this.cart_id}}}if(F(X,U)){if(Q.action_properties!==undefined){Q.action_properties.rec=true}else{if(Q.action_properties===undefined){Q.action_properties={rec:true}}}}}}}this.cart_id=I();T.session_id=e();T.action_type="bulk";return T}function f(Q){var P=false;if(Q!==undefined){if(Q.action===undefined){b.message="action name undefined";b.status="failed"}if(Q.user_id===undefined){b.message="user id undefined";b.status="failed"}}else{b.message="action data undefined";b.status="failed"}P=w(Q);if(P!==false){return B("POST",a+"predictry?",P)}else{console.log(JSON.stringify(b))}}function u(P){reco_data=M(P,j);reco_data=M(reco_data,G);if(reco_data.algo===undefined){reco_data.algo="otherusersalsoviewed"}var R;var Q=o(reco_data);reco_url=a+"recommendation?"+Q;if(typeof(noDrawingNeeded)==="undefined"){if(window.PE_recoType==="pe_grid"){R=v}else{R=O}}else{R=null}return B("GET",a+"recommendation?",reco_data)}function O(Q){if(Q!==null){try{var P=Q.recomm}catch(R){return}if("undefined"==typeof(P.length)){P=new Array(P)}if(P.length>0){listString="<ul>";for(x=0;x<P.length;x++){listString+='<li><a href="'+P[x].item_properties.item_url+'">'+P[x].description+"</a></li>"}elem_predictry.innerHTML+=listString+"</ul>"}}}function v(P){return"work in progress"}function J(P,R,Q){var S={item_id:P,description:R,properties:Q};return B("POST",a+"item?",S)}function A(P,Q,S){var R={widget_id:P,properties:Q,rec_items:S,session:e()};return B("POST",a+"widget?",R)}function I(){var P=B("POST",a+"cart?",{session:e()});var Q=false;if(P.status==="success"){Q=P.response.cart_id}return Q}function q(P,S,Q){var R={cart_id:k,item_id:P,qty:S,event:Q};return B("POST",a+"cartlog?",R)}function y(P){var Q=L();cartItemIDs=Q.c;if(P!==undefined&&!F(P,cartItemIDs)){cartItemIDs.push(P)}return g(cartItemIDs)}function m(P){var Q=L();cartItemIDs=Q.c;if(P!==undefined&&F(P,cartItemIDs)){cartItemIDs.pop(P)}return g(cartItemIDs)}function L(){var Q="predictry";var P=document.cookie.match(new RegExp(Q+"=([^;]+)"));if(P&&JSON.parse(P[1])){return JSON.parse(P[1])}else{return g()}}function g(Q){var P="predictry";var R={c:[],s:e()};if(Q!==undefined){R={c:Q,s:e()}}String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=P+"="+JSON.stringify(R)+"; path=/";return R}function M(Q,S){var R=Q;for(var P in S){src=R[P];copy=S[P];if(src!=null){continue}else{if(copy!==undefined){R[P]=copy}}}return R}function o(S,R){var P="";for(var Q in S){var T=S[Q];if(R!==undefined){P+=encodeURIComponent(Q)+"[]="+encodeURIComponent(T)+"&"}else{P+=encodeURIComponent(Q)+"="+encodeURIComponent(T)+"&"}}if(P.length>0){P=P.substring(0,P.length-1)}return P}function F(S,R){var Q=R.length;for(var P=0;P<Q;P++){if(R[P]===S){return true}}return false}function N(Q){var P=0;switch(Q.toLowerCase()){case"view":P=1;break;case"rate":P=2;break;case"add_to_cart":P=3;break;case"buy":P=4;break;default:P=1;break}return P}function C(){var P="predictry_session";var Q=n(15);String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=P+"="+Q+"; path=/";g();return Q}function n(P){chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";returnValue="";for(x=0;x<P;x++){i=Math.floor(Math.random()*62);returnValue+=chars.charAt(i)}return returnValue}function e(){var R="predictry_session=";var P=document.cookie.split(";");for(var Q=0;Q<P.length;Q++){var S=P[Q];while(S.charAt(0)==" "){S=S.substring(1,S.length)}if(S.indexOf(R)==0){return S.substring(R.length,S.length)}}return C()}function p(P){document.cookie=[P,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.",window.location.host.toString()].join("");return}function l(Q){if(null==Q||"object"!=typeof Q){return Q}var R=Q.constructor();for(var P in Q){if(Q.hasOwnProperty(P)){R[P]=Q[P]}}return R}function D(P){P=P.split("+").join(" ");var S={},R,Q=/[?&]?([^=]+)=([^&]*)/g;while(R=Q.exec(P)){S[decodeURIComponent(R[1])]=decodeURIComponent(R[2])}return S}return{init:E,getSessionID:e,sendAction:h,sendBulkActions:f,getRecommendedItems:u,updateItem:J,getCartID:I,getCartSession:L,setCartSession:y,removeItemCartSession:m,setCartLog:q,buildUrl:o,drawGrid:v,drawList:O,clone:l,widget_instance_id:K,cart_id:k}}(Predictry||function(){return undefined}));if(typeof Predictry!==undefined&&typeof Predictry==="object"){Predictry.init()};