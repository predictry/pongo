var PREDICTRY_API_URL="http://demo.predictry.com/api/v1/";var compulsary_params=new Array("user_id","action","item_id","session_id","description");var optional_params=new Array("item_properties","action_properties");var default_action_types=new Array("view","rate","add_to_cart","buy");var win=window;var PE_defaults={action:null,user_id:null,session_id:getSessionID(),item_id:null,description:""};var PE_options={placementId:win.PE_placementId,platformVer:win.PE_platformVer,recoType:win.PE_recoType,numberOfResults:win.PE_numberOfResults};var response={status:"success",message:""};var data={};var reco_data={};function setActionData(c){c=eExtend(c,PE_defaults);for(var a in c){if(!inArray(a,optional_params)){if(((c[a]===""||(c[a]===null))&&inArray(a,compulsary_params))){response.status="failed";response.message=a+" cannot be empty";return false}}if(a==="item_properties"){for(var b in c[a]){c["item_properties["+b+"]"]=c[a][b]}delete c.item_properties}if(a==="action_properties"){for(var b in c[a]){c["action_properties["+b+"]"]=c[a][b]}delete c.action_properties}}c.action_type="single";return c}function setTrackingData(c){reco_data=eExtend(c,PE_defaults);for(var a in c){if(!inArray(a,optional_params)){if(((c[a]===""||(c[a]===null))&&inArray(a,compulsary_params))){response.status="failed";response.message=a+" cannot be empty";return false}}if(a==="action_properties"){for(var b in c[a]){c["action_properties["+b+"]"]=c[a][b]}delete c.action_properties}}return true}function sendAction(b){var a=false;if(b!==undefined){a=setActionData(b)}else{response.message="action data undefined";response.status="failed"}if(a!==false){callPredictry(a)}else{console.log(JSON.stringify(response))}}function sendTracking(a){sendAction(a)}function callPredictry(a){var b="";if(a===undefined){b=buildUrl(data)}else{b=buildUrl(a)}if(b!==""){makeACall("POST",PREDICTRY_API_URL+"predictry?"+b)}else{return}}function makeACall(c,b){if(b===undefined){return}var a=new XMLHttpRequest();a.overrideMimeType("application/json");a.open(c,b,false);a.setRequestHeader("X-Predictry-Server-Tenant-ID",win.PE_tenantId);a.setRequestHeader("X-Predictry-Server-Api-Key",win.PE_apiKey);a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){jsonResponse=JSON.parse(a.responseText);return jsonResponse}};a.send(null)}function makeJqueryAjaxCall(d,b,c){var a="";if(typeof jQuery!=="undefined"){jQuery.ajax({type:d,url:b,async:false,data:c,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-Predictry-Server-Tenant-ID",win.PE_tenantId);e.setRequestHeader("X-Predictry-Server-Api-Key",win.PE_apiKey)},success:function(e){a=e},error:function(e){a=e}})}else{console.log("error >> jQuery required ");return}return a}function ajaxResultCallBack(a){return a}function setBulkActionData(a){var e=new Array("item_id","description");var d=new Array("item_properties","action_properties");for(var c=0;c<a.actions.length;c++){for(var b in a.actions[c]){if(!inArray(b,d)){if(((a.actions[c][b]===""||(a.actions[c][b]===null))&&inArray(b,e))){response.status="failed";response.message=b+" cannot be empty";return false}}}}a.session_id=getSessionID();a.action_type="bulk";return a}function sendBulkAction(b){var a=false;if(b!==undefined){if(b.action===undefined){response.message="action name undefined";response.status="failed"}if(b.user_id===undefined){response.message="user id undefined";response.status="failed"}}else{response.message="action data undefined";response.status="failed"}a=setBulkActionData(b);if(a!==false){makeJqueryAjaxCall("POST",PREDICTRY_API_URL+"predictry?",a)}else{console.log(JSON.stringify(response))}}function getRecommendation(b){reco_data=eExtend(b,PE_defaults);if(reco_data.algo===undefined){reco_data.algo="otherusersalsoviewed"}var d;var c=buildUrl(reco_data);reco_url=PREDICTRY_API_URL+"recommendation?"+c;if(typeof(noDrawingNeeded)==="undefined"){if(window.PE_recoType==="pe_grid"){d=drawListGridRecommendation}else{d=drawTextListRecommendation}}else{d=null}var a=makeJqueryAjaxCall("GET",reco_url,reco_data);return a}function drawTextListRecommendation(b){if(b!==null){try{var a=b.recomm}catch(c){return}if("undefined"==typeof(a.length)){a=new Array(a)}if(a.length>0){listString="<ul>";for(x=0;x<a.length;x++){listString+='<li><a href="'+a[x].item_properties.item_url+'">'+a[x].description+"</a></li>"}elem_predictry.innerHTML+=listString+"</ul>"}}}function drawListGridRecommendation(a){}function eExtend(b,d){var c=b;for(var a in d){src=c[a];copy=d[a];if(src!=null){continue}else{if(copy!==undefined){c[a]=copy}}}return c}function buildUrl(d,c){var a="";for(var b in d){var e=d[b];if(c!==undefined){a+=encodeURIComponent(b)+"[]="+encodeURIComponent(e)+"&"}else{a+=encodeURIComponent(b)+"="+encodeURIComponent(e)+"&"}}if(a.length>0){a=a.substring(0,a.length-1)}return a}function inArray(d,c){var b=c.length;for(var a=0;a<b;a++){if(c[a]===d){return true}}return false}function translateActionToRating(b){var a=0;switch(b.toLowerCase()){case"view":a=1;break;case"rate":a=2;break;case"add_to_cart":a=3;break;case"buy":a=4;break;default:a=1;break}return a}function createSessionID(){var a="predictry_session";var b=generateSessionID(15);String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=a+"="+b+"; path=/";return b}function generateSessionID(a){chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";returnValue="";for(x=0;x<a;x++){i=Math.floor(Math.random()*62);returnValue+=chars.charAt(i)}return returnValue}function getSessionID(){var d="predictry_session=";var a=document.cookie.split(";");for(var b=0;b<a.length;b++){var e=a[b];while(e.charAt(0)==" "){e=e.substring(1,e.length)}if(e.indexOf(d)==0){return e.substring(d.length,e.length)}}return createSessionID()};