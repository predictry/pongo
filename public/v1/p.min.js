var Predictry=(function(){var a="http://dashboard.predictry.com/api/v1/";var L=null;var z=window;var j={action:null,user_id:null,session_id:null,item_id:null,description:""};var H={widgetId:null,platformVer:null,recoType:null};var b=data=reco_data={};var I=optional_params=null;var k=-1;function F(){z=window;reco_data=data={};this.cart_id=J();H.widgetId=z.PE_widgetId;H.platformVer=z.PE_platformVer;H.recoType=z.PE_recoType;j.session_id=this.getSessionID();I=new Array("user_id","action","item_id","session_id","description");optional_params=new Array("item_properties","action_properties");b={status:"success",message:""};var Q=E(document.location.search);if(Q!==undefined&&typeof Q==="object"&&Q.predictry_src!==undefined){L=Q.predictry_src}}function s(S){S=N(S,j);if(L!==null){if(S.action_properties!==undefined){S.action_properties.rec=true}else{if(S.action_properties===undefined){S.action_properties={rec:true}}}}if(S.action==="complete_purchase"){if(S.action_properties!==undefined){S.action_properties.cart_id=this.cart_id}else{if(S.action_properties===undefined){S.action_properties={cart_id:this.cart_id}}}this.cart_id=J()}for(var Q in S){if(!G(Q,optional_params)){if(((S[Q]===""||(S[Q]===null))&&G(Q,I))){b.status="failed";b.message=Q+" cannot be empty";return false}}if(Q==="item_properties"){for(var R in S[Q]){S["item_properties["+R+"]"]=S[Q][R]}delete S.item_properties}if(Q==="action_properties"){for(var R in S[Q]){S["action_properties["+R+"]"]=S[Q][R]}delete S.action_properties}}S.action_type="single";return S}function t(S){reco_data=N(S,j);for(var Q in S){if(!G(Q,optional_params)){if(((S[Q]===""||(S[Q]===null))&&G(Q,I))){b.status="failed";b.message=Q+" cannot be empty";return false}}if(Q==="action_properties"){for(var R in S[Q]){S["action_properties["+R+"]"]=S[Q][R]}delete S.action_properties}}return true}function h(S){var R=false;if(S!==undefined){R=s(l(S))}else{Q.message="action data undefined";Q.status="failed"}if(R!==false){var Q=d(R);if(Q.status==="success"&&R.action==="add_to_cart"){if(L!==null){if(S.action_properties!==undefined){S.action_properties.rec=true}else{if(S.action_properties===undefined){S.action_properties={rec:true}}}}if(S.action_properties!==undefined){var T=(S.action_properties.qty!==undefined)?S.action_properties.qty:1;q(S.item_id,T,"added");if(S.action_properties.rec!==undefined&&S.action_properties.rec){y(S.item_id)}}else{q(S.item_id,1,"added")}}if(Q.status==="success"&&R.action==="complete_purchase"){g()}return Q}else{return JSON.stringify(Q)}}function c(Q){h(Q)}function d(Q){return B("POST",a+"predictry?",Q)}function r(S,R){if(R===undefined){return}var Q=new XMLHttpRequest();Q.overrideMimeType("application/json");Q.open(S,R,false);Q.setRequestHeader("X-Predictry-Server-Tenant-ID",z.PE_tenantId);Q.setRequestHeader("X-Predictry-Server-Api-Key",z.PE_apiKey);Q.onreadystatechange=function(){if(Q.readyState===4&&Q.status===200){jsonResponse=JSON.parse(Q.responseText);return jsonResponse}};Q.send(null)}function B(T,R,S){var Q="";if(typeof jQuery!=="undefined"){jQuery.ajax({type:T,url:R,async:false,data:S,dataType:"json",beforeSend:function(U){U.setRequestHeader("X-Predictry-Server-Tenant-ID",z.PE_tenantId);U.setRequestHeader("X-Predictry-Server-Api-Key",z.PE_apiKey)},success:function(U){Q=U},error:function(U){Q=U}})}else{console.log("error >> jQuery required ");return}return Q}function w(U){var T=new Array("item_id","description");var Q=new Array("item_properties","action_properties");for(var S=0;S<U.actions.length;S++){for(var W in U.actions[S]){if(!G(W,Q)){if(((U.actions[S][W]===""||(U.actions[S][W]===null))&&G(W,T))){b.status="failed";b.message=W+" cannot be empty";return false}}if(U.action==="complete_purchase"&&W==="item_id"){var Y=U.actions[S][W];var X=M();var V=X.c;var R=U.actions[S];if(R.action_properties!==undefined){R.action_properties.cart_id=this.cart_id}else{if(R.action_properties===undefined){R.action_properties={cart_id:this.cart_id}}}if(G(Y,V)){if(R.action_properties!==undefined){R.action_properties.rec=true}else{if(R.action_properties===undefined){R.action_properties={rec:true}}}}}}}this.cart_id=J();U.session_id=e();U.action_type="bulk";return U}function f(R){var Q=false;if(R!==undefined){if(R.action===undefined){b.message="action name undefined";b.status="failed"}if(R.user_id===undefined){b.message="user id undefined";b.status="failed"}}else{b.message="action data undefined";b.status="failed"}Q=w(R);if(Q!==false){return B("POST",a+"predictry?",Q)}else{console.log(JSON.stringify(b))}}function u(Q){reco_data=N(Q,j);reco_data=N(reco_data,H);var S;var R=o(reco_data);reco_url=a+"recommendation?"+R;if(typeof(noDrawingNeeded)==="undefined"){if(window.PE_recoType==="pe_grid"){S=v}else{S=P}}else{S=null}return B("GET",a+"recommendation?",reco_data)}function P(R){if(R!==null){try{var Q=R.recomm}catch(S){return}if("undefined"==typeof(Q.length)){Q=new Array(Q)}if(Q.length>0){listString="<ul>";for(x=0;x<Q.length;x++){listString+='<li><a href="'+Q[x].item_properties.item_url+'">'+Q[x].description+"</a></li>"}elem_predictry.innerHTML+=listString+"</ul>"}}}function v(Q){return"work in progress"}function K(Q,S,R){var T={item_id:Q,description:S,properties:R};return B("POST",a+"item?",T)}function A(Q,R,T){var S={widget_id:Q,properties:R,rec_items:T,session:e()};return B("POST",a+"widget?",S)}function J(){var Q=B("POST",a+"cart?",{session:e()});var R=false;if(Q.status==="success"){R=Q.response.cart_id}return R}function q(Q,T,R){var S={cart_id:k,item_id:Q,qty:T,event:R};return B("POST",a+"cartlog?",S)}function y(Q){var R=M();cartItemIDs=R.c;if(Q!==undefined&&!G(Q,cartItemIDs)){cartItemIDs.push(Q)}return g(cartItemIDs)}function m(Q){var R=M();cartItemIDs=R.c;if(Q!==undefined&&G(Q,cartItemIDs)){cartItemIDs.pop(Q)}return g(cartItemIDs)}function M(){var R="predictry";var Q=document.cookie.match(new RegExp(R+"=([^;]+)"));if(Q&&JSON.parse(Q[1])){return JSON.parse(Q[1])}else{return g()}}function g(R){var Q="predictry";var S={c:[],s:e()};if(R!==undefined){S={c:R,s:e()}}String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=Q+"="+JSON.stringify(S)+"; path=/";return S}function N(R,T){var S=R;for(var Q in T){src=S[Q];copy=T[Q];if(src!=null){continue}else{if(copy!==undefined){S[Q]=copy}}}return S}function o(T,S){var Q="";for(var R in T){var U=T[R];if(S!==undefined){Q+=encodeURIComponent(R)+"[]="+encodeURIComponent(U)+"&"}else{Q+=encodeURIComponent(R)+"="+encodeURIComponent(U)+"&"}}if(Q.length>0){Q=Q.substring(0,Q.length-1)}return Q}function G(T,S){var R=S.length;for(var Q=0;Q<R;Q++){if(S[Q]===T){return true}}return false}function O(R){var Q=0;switch(R.toLowerCase()){case"view":Q=1;break;case"rate":Q=2;break;case"add_to_cart":Q=3;break;case"buy":Q=4;break;default:Q=1;break}return Q}function C(Q){var R=n(15);String((new Date()).getTime()).replace(/\D/gi,"");document.cookie=Q+"="+R+"; path=/";g();return R}function n(Q){chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";returnValue="";for(x=0;x<Q;x++){i=Math.floor(Math.random()*62);returnValue+=chars.charAt(i)}return returnValue}function e(){var S="predictry_session=";var Q=document.cookie.split(";");for(var R=0;R<Q.length;R++){var T=Q[R];while(T.charAt(0)==" "){T=T.substring(1,T.length)}if(T.indexOf(S)==0){return T.substring(S.length,T.length)}}return C("predictry_session")}function D(){var S="predictry_userid=";var Q=document.cookie.split(";");for(var R=0;R<Q.length;R++){var T=Q[R];while(T.charAt(0)==" "){T=T.substring(1,T.length)}if(T.indexOf(S)==0){return T.substring(S.length,T.length)}}return C("predictry_userid")}function p(Q){document.cookie=[Q,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.",window.location.host.toString()].join("");return}function l(R){if(null==R||"object"!=typeof R){return R}var S=R.constructor();for(var Q in R){if(R.hasOwnProperty(Q)){S[Q]=R[Q]}}return S}function E(Q){Q=Q.split("+").join(" ");var T={},S,R=/[?&]?([^=]+)=([^&]*)/g;while(S=R.exec(Q)){T[decodeURIComponent(S[1])]=decodeURIComponent(S[2])}return T}return{init:F,getSessionID:e,getSessionUserID:D,sendAction:h,sendBulkActions:f,getRecommendedItems:u,updateItem:K,getCartID:J,getCartSession:M,setCartSession:y,removeItemCartSession:m,setCartLog:q,buildUrl:o,drawGrid:v,drawList:P,clone:l,widget_instance_id:L,cart_id:k}}(Predictry||function(){return undefined}));if(typeof Predictry!==undefined&&typeof Predictry==="object"){Predictry.init()};